{% extends 'd2api/base.html' %}

{% block title %}DESTINY 2 - TAKE A LOOK{% endblock title %}

{% load static %}
{% block style %}
{% endblock style %}

{% block script %}
<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<script>
    let accessToken = "";

    function getAuth() {
        $.ajax({
            url: "{% url 'd2api:get_auth' %}"
        }).done(function (res) {
            location.href = res['authorization_url'];
        }).fail(function (e) {
            console.log(e);
        });
    }

    function fetchToken() {
        $.ajax({
            url: "{% url 'd2api:fetch_token' %}",
            type: "post",
            data: JSON.stringify({
                'auth_res': location.search
            }),
            headers: {
                'X-CSRFTOKEN': "{{ csrf_token }}"
            }
        }).done(function (res) {
            accessToken = res['access_token'];
        }).fail(function (e) {
            console.log(e);
        });
    }

    function refreshToken() {
        $.ajax({
            url: "{% url 'd2api:refresh_token' %}"
        }).done(function (res) {
            console.log("success");
            console.log(res);
        }).fail(function (e) {
            console.log("error");
            console.log(e);
        });
    }

    function requstData() {
        // alert(accessToken);
        $.ajax({
            url: "{% url 'd2api:request_data' %}"
        }).done(function (res) {
            console.log("success");
            console.log(res);
        }).fail(function (e) {
            console.log("error");
            console.log(e);
        });
    }
</script>
{% endblock script %}

{% block body %}
<h1>DESTINY 2 - TAKE A LOOK</h1>
<button onclick="getAuth();">Get Authorization</button>
<button onclick="fetchToken();">Fetch Token</button>
<button onclick="refreshToken();">Refresh Token</button>
<button onclick="requstData();">Request Data</button>
{% endblock body %}